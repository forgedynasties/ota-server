cd4li@AliHassan-PF418342:/$ ./simulate_ota.sh http://10.32.1.11:8000
🚀 Starting OTA Update Simulation
Server URL: http://10.32.1.11:8000

======================================
🔍 CONNECTIVITY TEST
======================================

🔄 Testing server connectivity...
✅ Server is reachable

======================================
📋 SERVER METADATA
======================================

🔄 Fetching server metadata...
Available firmware versions:
{
    "build-1001": {
        "version": "1.1.0",
        "filename": "ota-1.1.0.zip",
        "release_date": "2025-09-01"
    },
    "build-1002": {
        "version": "1.2.0",
        "filename": "ota-1.2.0.zip",
        "release_date": "2025-09-15"
    },
    "build-1003": {
        "version": "1.3.0",
        "filename": "ota-1.3.0.zip",
        "release_date": "2025-09-29"
    }
}

======================================
📱 DEVICE SIMULATION SCENARIOS
======================================


--- Scenario 1: Device with Older Build ---
🔄 Device 'device_alpha' with build 'build-1001' checking for updates (older build, expecting update to build-1002)
Response: {"status":"update-available","version":"1.2.0","build_id":"build-1002","url":"/packages/ota-1.2.0.zip","checksum":"2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325","signature":"06089c0b0e1b3ea46e4a88edcf2f5f3c495b5eac662c42a1b0ec47911a5251a7aa3e5cfc0dbd55ccde29f77558dd6c1c465e7a23e4c742c05d978bb4bc5fed42f1352ee56d15eecf21ea1d0ca12d76748b8af8b1bf9669a14ab6e080e2b0658cbc2068d4a00380ed36aa157908e622855444e4b9e1ab894162b20e0c822050952f24ef53e93c5604e6d6708748e6cc4bd5cfbe3313b23c0e555a57767a0fe8fd3688f2c1c294594e4731d639bf5ded95f50d77b3a3b87f06d4a4b1e6e2da85d6a9f191746d8313024df6066ad30e4104268b069cd4dc4f52bbafbe3e5ca93642be1dda3bc86e1d97b64aa545b96ace2683635dfc856a3de6566bc86b4319e17e"}
✅ Update available!
ℹ️  New Version: 1.2.0
ℹ️  New Build ID: build-1002
ℹ️  Download URL: /packages/ota-1.2.0.zip
ℹ️  Checksum: 2558a34d4d20964c...
🔄 Downloading update package...
✅ Downloaded ota-1.2.0.zip
🔄 Verifying checksum...
✅ Checksum verification passed
ℹ️  Expected: 2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
ℹ️  Actual:   2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
🔄 Simulating firmware installation...
✅ Firmware installation completed

--- Scenario 2: Device with Middle Build ---
🔄 Device 'device_beta' with build 'build-1002' checking for updates (middle build, expecting update to build-1003)
Response: {"status":"update-available","version":"1.3.0","build_id":"build-1003","url":"/packages/ota-1.3.0.zip","checksum":"054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a","signature":"3eb8603b720efdbe89af5d7be7032bc9c359f48d72c9586da54fd819faa8609466f85e0e6b8db5d005c0f7d0a145dd785ef49e59fcb9f99bc6e9f411b0795223e5b67020c54f7f41ac555cb5ea547048cc8ce8d53ec3b45462bca7a6225865709084f0075da3eed74566c1474bd717d381e00124b71d52ed6be1c88de6a65d0f3a9651104157f73c48d8d72958cd6dd4e80181ff17f9f00b2f2242561d59a139d3fdb93b1534d791abd97f55739ab67d082fcf483a87119f0d6d5abf324fd87f8c244985ffc6112a765f59b20e9f004d115846cf00abe244402badc31e51acb619f1b3f4a4775181561ef22b75a63e3e04c00a908db621c0e3a3ab62cb6cff88"}
✅ Update available!
ℹ️  New Version: 1.3.0
ℹ️  New Build ID: build-1003
ℹ️  Download URL: /packages/ota-1.3.0.zip
ℹ️  Checksum: 054e3b308708370e...
🔄 Downloading update package...
✅ Downloaded ota-1.3.0.zip
🔄 Verifying checksum...
✅ Checksum verification passed
ℹ️  Expected: 054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a
ℹ️  Actual:   054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a
🔄 Simulating firmware installation...
✅ Firmware installation completed

--- Scenario 3: Device with Latest Build ---
🔄 Device 'device_gamma' with build 'build-1003' checking for updates (latest build, expecting up-to-date)
Response: {"status":"up-to-date"}
✅ Device is up-to-date

--- Scenario 4: Device with Unknown Build ---
🔄 Device 'device_delta' with build 'build-9999' checking for updates (unknown build, expecting device-not-found)
Response: {"status":"device-not-found","message":"Current build ID not found"}
❌ Device build ID not found in metadata

======================================
🔄 CONCURRENT DEVICE SIMULATION
======================================


--- Scenario 5: Multiple Devices Checking Updates ---

Device: phone_001
🔄 Device 'phone_001' with build 'build-1001' checking for updates (concurrent check)
Response: {"status":"update-available","version":"1.2.0","build_id":"build-1002","url":"/packages/ota-1.2.0.zip","checksum":"2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325","signature":"06089c0b0e1b3ea46e4a88edcf2f5f3c495b5eac662c42a1b0ec47911a5251a7aa3e5cfc0dbd55ccde29f77558dd6c1c465e7a23e4c742c05d978bb4bc5fed42f1352ee56d15eecf21ea1d0ca12d76748b8af8b1bf9669a14ab6e080e2b0658cbc2068d4a00380ed36aa157908e622855444e4b9e1ab894162b20e0c822050952f24ef53e93c5604e6d6708748e6cc4bd5cfbe3313b23c0e555a57767a0fe8fd3688f2c1c294594e4731d639bf5ded95f50d77b3a3b87f06d4a4b1e6e2da85d6a9f191746d8313024df6066ad30e4104268b069cd4dc4f52bbafbe3e5ca93642be1dda3bc86e1d97b64aa545b96ace2683635dfc856a3de6566bc86b4319e17e"}
✅ Update available!
ℹ️  New Version: 1.2.0
ℹ️  New Build ID: build-1002
ℹ️  Download URL: /packages/ota-1.2.0.zip
ℹ️  Checksum: 2558a34d4d20964c...
🔄 Downloading update package...
✅ Downloaded ota-1.2.0.zip
🔄 Verifying checksum...
✅ Checksum verification passed
ℹ️  Expected: 2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
ℹ️  Actual:   2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
🔄 Simulating firmware installation...
✅ Firmware installation completed

Device: tablet_002
🔄 Device 'tablet_002' with build 'build-1002' checking for updates (concurrent check)
Response: {"status":"update-available","version":"1.3.0","build_id":"build-1003","url":"/packages/ota-1.3.0.zip","checksum":"054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a","signature":"3eb8603b720efdbe89af5d7be7032bc9c359f48d72c9586da54fd819faa8609466f85e0e6b8db5d005c0f7d0a145dd785ef49e59fcb9f99bc6e9f411b0795223e5b67020c54f7f41ac555cb5ea547048cc8ce8d53ec3b45462bca7a6225865709084f0075da3eed74566c1474bd717d381e00124b71d52ed6be1c88de6a65d0f3a9651104157f73c48d8d72958cd6dd4e80181ff17f9f00b2f2242561d59a139d3fdb93b1534d791abd97f55739ab67d082fcf483a87119f0d6d5abf324fd87f8c244985ffc6112a765f59b20e9f004d115846cf00abe244402badc31e51acb619f1b3f4a4775181561ef22b75a63e3e04c00a908db621c0e3a3ab62cb6cff88"}
✅ Update available!
ℹ️  New Version: 1.3.0
ℹ️  New Build ID: build-1003
ℹ️  Download URL: /packages/ota-1.3.0.zip
ℹ️  Checksum: 054e3b308708370e...
🔄 Downloading update package...
✅ Downloaded ota-1.3.0.zip
🔄 Verifying checksum...
✅ Checksum verification passed
ℹ️  Expected: 054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a
ℹ️  Actual:   054e3b308708370ea029dc2ebd1646c498d59d7203c9e1a44cf0484df98e581a
🔄 Simulating firmware installation...
✅ Firmware installation completed

Device: iot_sensor_003
🔄 Device 'iot_sensor_003' with build 'build-1001' checking for updates (concurrent check)
Response: {"status":"update-available","version":"1.2.0","build_id":"build-1002","url":"/packages/ota-1.2.0.zip","checksum":"2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325","signature":"06089c0b0e1b3ea46e4a88edcf2f5f3c495b5eac662c42a1b0ec47911a5251a7aa3e5cfc0dbd55ccde29f77558dd6c1c465e7a23e4c742c05d978bb4bc5fed42f1352ee56d15eecf21ea1d0ca12d76748b8af8b1bf9669a14ab6e080e2b0658cbc2068d4a00380ed36aa157908e622855444e4b9e1ab894162b20e0c822050952f24ef53e93c5604e6d6708748e6cc4bd5cfbe3313b23c0e555a57767a0fe8fd3688f2c1c294594e4731d639bf5ded95f50d77b3a3b87f06d4a4b1e6e2da85d6a9f191746d8313024df6066ad30e4104268b069cd4dc4f52bbafbe3e5ca93642be1dda3bc86e1d97b64aa545b96ace2683635dfc856a3de6566bc86b4319e17e"}
✅ Update available!
ℹ️  New Version: 1.2.0
ℹ️  New Build ID: build-1002
ℹ️  Download URL: /packages/ota-1.2.0.zip
ℹ️  Checksum: 2558a34d4d20964c...
🔄 Downloading update package...
✅ Downloaded ota-1.2.0.zip
🔄 Verifying checksum...
✅ Checksum verification passed
ℹ️  Expected: 2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
ℹ️  Actual:   2558a34d4d20964ca1d272ab26ccce9511d880579593cd4c9e01ab91ed00f325
🔄 Simulating firmware installation...
✅ Firmware installation completed

Device: gateway_004
🔄 Device 'gateway_004' with build 'build-1003' checking for updates (concurrent check)
Response: {"status":"up-to-date"}
✅ Device is up-to-date

======================================
🔧 ADDITIONAL ENDPOINT TESTS
======================================

🔄 Testing checksum endpoint for ota-1.1.0.zip
Checksum Response: {"filename":"ota-1.1.0.zip","checksum":"76301a8cc6e96787efa14221f833029b711c437dbb7873d6385ce73735655296","signature":"8c0a0926e66112a65c2868ef9ee18c3c03923db56ed5ba22180d5e37a1dd735d2be8a73aef1118989c4231042f8ec8120b91628bc1b125901cdb16f451b6105f07198b464a9a9bfece95e614577e7c0c67aa19676298a49da33acb1fc7c86af08ed07f7977a680a2c117804bbdcf0d30ab5413fcdb563a03b63b63545681820517f08d8ef4808b23db723574876b9dc71be1047f36b4b15be2c07e19571e949df1e14ced5f56cf22f1f89e2f0cbef2629043aa53d5a5022daaa53f0ffb1d95d697556e33ea70d24113067e104547b1a0a185b3db8e587518f6230d1f977586fc1800883a17965cfd653c1d3bdce5f18bf7686fdfcd49b44a63b1a9c85dbdbead"}
ℹ️  File checksum: 76301a8cc6e96787efa14221f833029b...
✅ Checksum endpoint working correctly
🔄 Testing direct package download...
✅ Package download endpoint is working (HTTP 200)
🔄 Checking package file details...
ℹ️  Package size: 31 bytes
✅ Package contains data

======================================
🧹 CLEANUP
======================================

🔄 Cleaning up temporary files...
✅ Cleanup completed

======================================
📊 SIMULATION SUMMARY
======================================

✅ OTA Update simulation completed successfully!
ℹ️  Check the server logs for detailed request information
💡 To view the admin dashboard: http://10.32.1.11:8000/admin/metadata

🎯 Key Testing Points Covered:
• Server connectivity and metadata retrieval
• Sequential update logic based on release dates
• Update availability checking
• Package download and checksum verification
• Error handling for unknown builds
• Concurrent device simulation
• Additional API endpoint validation